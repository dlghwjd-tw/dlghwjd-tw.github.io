<!-- 
    v2.5 of My HTML
    -Bugs fixed

    Forecast function:
    - News feed
-->

<!DOCTYPE html>
<html lang="zh-Hant-HK">

<head>
    <meta charset="UTF-8">
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0'>
    <title>MZ & BB Web</title>
    <!-- Page Style -->
    <style>
        * {
            margin: 0;
            box-sizing: border-box;
            cursor: default;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        body {
            color: #ffffff;
            background-color: #1a1a1a;
            font-size: 10px;
            min-width: 350px;
            overflow: hidden;
        }

        ::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }

        .link {
            cursor: pointer;
        }

        .link:hover {
            color: #daa520;
        }

        .flexbox {
            display: flex;
            align-items: center;
        }

        .box {
            background-color: #242526;
            padding: 10px 20px;
            margin-bottom: 20px;
            border-radius: 25px;
        }

        .textField {
            color: #aaaaaa;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 7px 10px;
            border-radius: 25px;
        }
    </style>

    <!-- Header Style -->
    <style>
        header {
            background-color: #242526;
            width: auto;
            height: 68px;
            border-bottom: 1px solid #444444;
            font-weight: bold;
            color: #ffffff;
            display: flex;
            align-items: center;
        }

        #webName {
            padding-left: 10px;
            text-align: center;
            font-size: 30px;
            font-weight: bold;
            display: none;
            white-space: nowrap;
        }

        .icon {
            background-color: rgba(255, 255, 255, 0.1);
            font-size: 12px;
            height: 52px;
            width: 52px;
            margin: 5px;
            border-radius: 52px;
            word-wrap: break-word;
            display: none;
            text-align: center;
            justify-content: center;
            align-items: center;
        }

        .icon:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        #logoutBtnSplit {
            flex: 1;
        }
    </style>

    <!-- Content Style -->
    <style>
        #content {
            height: calc(100vh - 68px - 40px);
            padding: 15px 10px;
        }

        section {
            display: none;
        }
    </style>

    <!-- Login Form Style -->
    <style>
        #loginHeading {
            font-weight: bold;
            font-size: 20px;
            text-align: center;
        }

        #loginMessage {
            color: red;
        }

        #login-form {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #login-form * {
            margin: 5px 0;
            width: 70%;
            border: 0;
        }

        #pwForLogin {
            color: #ffffff;
        }

        #loginBtnForLogin {
            width: initial;
        }
    </style>

    <!-- Home Style -->
    <style>
        #welcomeMessage {
            text-align: center;
        }

        #counter {
            display: flex;
            flex-direction: column;
        }

        #countdown {
            margin-left: 20px;
            align-self: flex-end;
        }

        #function {
            background-color: #242526;
            padding: 10px 20px;
            margin-bottom: 20px;
            border-radius: 25px;
        }

        #functionHeading {
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-bottom: 1px solid #444444;
        }

        #functionsBox {
            display: flex;
            flex-wrap: nowrap;
            justify-content: space-evenly;
        }

        .functions {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            margin: 10px 5px 0;
            padding: 10px;
            flex: 1;
            text-align: center;
            white-space: nowrap;
        }

        .functions:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
    </style>

    <!-- Password Manager Style -->
    <style>
        #pwMgrHeading {
            text-align: center;
        }

        #searchBox {
            color: #aaaaaa;
            width: 100%;
        }

        #pwList {
            background-color: #242526;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 25px;
            display: flex;
        }

        #webList {
            height: calc(100vh - 67px - 15px - 62px - 62px - 35px - 39px);
            border-right: 1px solid #444444;
            flex: 1;
            overflow-x: hidden;
            overflow-y: scroll;
        }

        .web {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 7px 10px;
            margin-right: 10px;
            margin-bottom: 10px;
            border-radius: 25px;
        }

        #pwDetail {
            height: calc(100vh - 67px - 15px - 62px - 62px - 35px - 39px);
            flex: 2;
            overflow-x: hidden;
            overflow-y: scroll;
        }

        .pwContent {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 15px;
            margin-left: 10px;
            margin-bottom: 10px;
            border-radius: 25px;
        }

        .pw {
            margin-bottom: 10px;
            color: #ffffff;
        }

        .alertBoxBackground {
            background: rgba(90, 90, 90, 0.3);
            height: calc(100vh - 67px - 39px);
            width: 100%;
            position: absolute;
            top: 67px;
            left: 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-content: center;
            align-items: center;
        }

        .alertBox {
            background-color: #242526;
            padding: 10px 20px;
            border-radius: 25px;
            flex-wrap: wrap;
            margin: 0 100%;
        }

        .alertBox * {
            margin: 5px 0;
        }
    </style>

    <!-- Password Saver Style -->
    <style>
        #pwSaveHeading {
            text-align: center;
        }

        #pwSaveForm div {
            padding: 10px 0;
            display: flex;
            justify-content: space-between;
        }

        #pwSaveForm span {
            margin: auto 0;
        }

        #webSelectionForPwSave {
            width: calc(100% - 140px);
            color: #ffffff;
            border: 0;
        }

        #webSelectionForPwSave option {
            color: initial;
        }

        #pwSaveForm .textField {
            width: calc(100% - 140px);
        }
    </style>

    <!-- Password Creator Style -->
    <style>
        #pwCreateHeading {
            text-align: center;
        }

        #pwGenForm span {
            margin-right: 2vw;
        }

        #showPwForGen {
            width: 40%;
            min-width: 200px;
            color: #ffffff;
        }

        #genPwSaveForm div {
            padding: 10px 0;
            display: flex;
            justify-content: space-between;
        }

        #webSelectionForGenPw {
            width: calc(100% - 140px);
            color: #ffffff;
            border: 0;
        }

        #webSelectionForGenPw option {
            color: initial;
        }

        #genPwSaveForm span {
            margin: auto 0;
        }

        #genPwSaveForm .textField {
            width: calc(100% - 140px);
        }
    </style>

    <!-- Footer Style -->
    <style>
        footer {
            background-color: #242526;
            width: 100%;
            padding: 10px 20px;
            color: #ffffff;
            font-size: 12px;
            border-top: 1px solid #444444;
            text-align: center;
            position: fixed;
            bottom: 0;
        }
    </style>

    <!-- PC Style -->
    <style>
        @media screen and (min-width: 650px) and (max-width: 999px) {
            #webNameSplit {
                flex: 1;
            }

            #logoutBtnSplit {
                flex: 1;
            }

            .box:hover {
                background-color: rgba(255, 255, 255, 0.2);
            }

            .web:hover {
                background-color: rgba(255, 255, 255, 0.2);
            }

            .pwContent:hover {
                background-color: rgba(255, 255, 255, 0.2);
            }
        }

        @media screen and (min-width: 1000px) {
            header {
                padding-left: calc((100vw - 1000px)/2);
                padding-right: calc((100vw - 1000px)/2);
            }

            #webNameSplit {
                width: 66px;
            }

            #logoutBtnSplit {
                flex: 1;
            }

            #content {
                padding-left: calc((100vw - 1000px + 20px)/2);
                padding-right: calc((100vw - 1000px + 20px)/2);
            }

            .box:hover {
                background-color: rgba(255, 255, 255, 0.2);
            }

            .web:hover {
                background-color: rgba(255, 255, 255, 0.2);
            }

            .pwContent:hover {
                background-color: rgba(255, 255, 255, 0.2);
            }
        }
    </style>
</head>

<body>
    <header>
        <div id='webName'>MZ與BB豬的個人網站</div>
        <div id='webNameSplit'></div>
        <div class='homeBtn icon link'>MZ<br>BB</div>
        <div class='pwMgrBtn icon link'>密碼<br>管理</div>
        <div class='pwSaveBtn icon link'>另存<br>密碼</div>
        <div class='pwCreateBtn icon link'>創建<br>密碼</div>
        <div id='logoutBtnSplit'></div>
        <div class='logoutBtn icon link'>登出</div>
    </header>

    <div id='content'>
        <section id='loginScreen'>
            <div id='loginHeading' class='box'>登入</div>
            <div id='login-form' class='box'>
                <span>電郵: </span>
                <div id='emailForLogin' class='textField' contenteditable='true'>電郵</div>
                <span>密碼: </span>
                <input type='password' id='pwForLogin' class='textField' placeholder='密碼' contenteditable='true'>
                <button id='loginBtnForLogin'>登入</button>
            </div>
            <p id='loginMessage'></p>
        </section>
        <section id='homeScreen'>
            <div class='box'>
                <div id='welcomeMessage'></div>
            </div>
            <div id='counter' class='box'>
                <div>紀念日計算器 - 由2018年5月12日起:</div>
                <div id='countdown'></div>
            </div>
            <div id='function'>
                <div id='functionHeading'>V2.5功能</div>
                <div id='functionsBox'>
                    <div class='pwMgrBtn link functions'>密碼管理</div>
                    <div class='pwSaveBtn link functions'>另存密碼</div>
                    <div class='pwCreateBtn link functions'>創建密碼</div>
                </div>
            </div>
        </section>
        <section id='pwMgrScreen'>
            <div id='pwMgrHeading' class='box'>管理密碼</div>
            <div id='searchBox' class='box' contenteditable='true'>搜尋...</div>
            <div id='pwList'>
                <div id='webList'>
                </div>
                <div id='pwDetail'>
                </div>
            </div>
        </section>
        <section id='pwSaveScreen'>
            <div id='pwSaveHeading' class='box'>另存密碼</div>
            <div id='pwSaveForm' class='box'>
                <div><span>網頁: </span><select name='web' id='webSelectionForPwSave' class='textField'></select></div>
                <div style='justify-content: flex-end;'>
                    <span id='webIfOtherForPwSave' class='textField' contenteditable='true'>其他網頁...</span>
                </div>
                <div>
                    <span>登入ID: </span>
                    <span id='loginIDForPwSave' class='textField' contenteditable='true'>登入ID</span>
                </div>
                <div>
                    <span>登入密碼: </span>
                    <span id='loginPwForPwSave' class='textField' contenteditable='true'>登入密碼</span>
                </div>
                <div><button id='saveBtnForPwSave'>儲存</button></div>
            </div>
            <div id='savingStatusForPwSave'></div>
        </section>
        <section id='pwCreateScreen'>
            <div id='pwCreateHeading' class='box'>創建密碼</div>
            <form id='pwGenForm' class='box'>
                <label style='text-decoration: underline;'>密碼位數: </label><br>
                <input type='radio' name='numOfDigits' id='genFor8Digits' value='8' style='margin-top: 10px;'>
                <span>8位</span>
                <input type='radio' name='numOfDigits' id='genFor10Digits' value='10'> <span>10位</span>
                <input type='radio' name='numOfDigits' id='genFor12Digits' value='12'> <span>12位</span>
                <input type='radio' name='numOfDigits' id='genFor15Digits' value='15'> <span>15位</span>
                <input type='radio' name='numOfDigits' id='genFor20Digits' value='20'> <span>20位</span><br>
                <input type='checkbox' name='genContainsSymbols' id='genContainsSymbols' value='true'
                    style='margin-top: 10px; margin-right: 5px;'>不含符號<br>
                <input type='submit' id='submit' value='創建' style='margin-top: 10px;'>
            </form>
            <div class='box'>
                <div style='text-decoration: underline; margin-bottom: 10px;'>密碼: </div>
                <div class='flexbox'>
                    <div id='showPwForGen' class='textField' style='color: #aaaaaa;'>請選擇密碼位數並創建</div>
                    <button id='copyGenPw' style='margin-left: 10px;'>複製</button>
                </div>
            </div>
            <div id='genPwSaveForm' class='box'>
                <div style='text-decoration: underline;'>另存密碼: </div>
                <div>
                    <span>網頁: </span>
                    <select name='webForGenPw' id='webSelectionForGenPw' class='textField'></select>
                </div>
                <div style='justify-content: flex-end;'>
                    <span id='webIfOtherForGenPw' class='textField' contenteditable='true'>其他網頁...</span>
                </div>
                <div>
                    <span>登入ID: </span>
                    <span id='loginIDForGenPw' class='textField' contenteditable='true'>登入ID</span>
                </div>
                <div><button id='saveBtnForGenPw'>儲存</button></div>
            </div>
            <div id='savingStatusForGenPw'></div>
        </section>
    </div>

    <footer>
        <div>Copyright © 2020-2021 MZ. All Rights Reserved.</div>
    </footer>

    <!-- Firebase config -->
    <script src="https://www.gstatic.com/firebasejs/8.1.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.1.2/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.1.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.1.2/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.1.2/firebase-database.js"></script>
    <script>
        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyDeQRXgmt8TGpimvIqjA2xfIGz6K4i8R7o",
            authDomain: "mz-and-bb-web.firebaseapp.com",
            databaseURL: "https://mz-and-bb-web.firebaseio.com",
            projectId: "mz-and-bb-web",
            storageBucket: "mz-and-bb-web.appspot.com",
            messagingSenderId: "1031342826508",
            appId: "1:1031342826508:web:d421be036367526fae7a29"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
    </script>

    <!-- My Script-->
    <script>
        var homeScreenEle = document.querySelector('#homeScreen')
        var loginScreenEle = document.querySelector('#loginScreen')
        var pwMgrScreenEle = document.querySelector('#pwMgrScreen')
        var pwSaveScreenEle = document.querySelector('#pwSaveScreen')
        var pwCreateScreenEle = document.querySelector('#pwCreateScreen')
        var welcomeMessageEle = document.querySelector('#welcomeMessage')
        var webNameEle = document.querySelector('#webName')
        var webNameSplitEle = document.querySelector('#webNameSplit')
        var iconEle = document.querySelectorAll('.icon')
        var logoutBtnEle = document.querySelectorAll('.logoutBtn')
        var homeBtnEle = document.querySelectorAll('.homeBtn')
        var pwMgrBtnEle = document.querySelectorAll('.pwMgrBtn')
        var pwSaveBtnEle = document.querySelectorAll('.pwSaveBtn')
        var pwCreateBtnEle = document.querySelectorAll('.pwCreateBtn')
        const db = firebase.firestore()
        window.addEventListener('DOMContentLoaded', function () {
            function copyDivToClipboard(eleID) {
                var range = document.createRange();
                range.selectNodeContents(document.getElementById(eleID));
                window.getSelection().removeAllRanges(); // clear current selection
                window.getSelection().addRange(range); // to select text
                document.execCommand("copy");
                window.getSelection().removeAllRanges();// to deselect
            }

            // Header Section
            var widthOver650px = window.matchMedia("(min-width: 650px)")
            if (matchMedia) {
                widthOver650px.addListener(WidthChange)
                WidthChange(widthOver650px)
            }
            function WidthChange(width) {
                if (width.matches) {
                    webNameEle.style.display = 'block'
                    webNameEle.style.width = '310px'
                    webNameSplitEle.style.display = 'block'
                } else {
                    webNameEle.style.display = 'none'
                    webNameSplitEle.style.display = 'none'
                }
            }

            // Login Section
            var emailForLoginEle = document.querySelector('#emailForLogin')
            var pwForLoginEle = document.querySelector('#pwForLogin')
            var loginBtnForLoginEle = document.querySelector('#loginBtnForLogin')
            var loginMessageEle = document.querySelector('#loginMessage')
            firebase.auth().onAuthStateChanged((user) => {
                if (user) {
                    var email = firebase.auth().currentUser.email
                    homeScreenEle.style.display = 'block'
                    welcomeMessageEle.innerHTML = '歡迎回來, ' + email.split('@')[0]
                    logoutBtnEle.forEach((ele) => { ele.style.display = 'flex' })
                    iconEle.forEach((ele) => {
                        ele.style.display = 'flex'
                    })
                } else {
                    loginScreenEle.style.display = 'block'
                    webNameEle.style.display = 'block'
                    webNameSplitEle.style.display = 'block'
                }
            });
            emailForLoginEle.addEventListener('focus', () => {
                if (emailForLoginEle.innerHTML == '電郵') {
                    emailForLoginEle.innerHTML = ''
                    emailForLoginEle.style.color = '#ffffff'
                    emailForLoginEle.style.outlineStyle = 'none'
                }
            })
            emailForLoginEle.addEventListener('focusout', () => {
                if (emailForLoginEle.innerHTML == '') {
                    emailForLoginEle.innerHTML = '電郵'
                    emailForLoginEle.style.color = '#aaaaaa'
                }
            })
            emailForLoginEle.addEventListener('keypress', (e) => {
                if (e.which == 13) {
                    e.preventDefault()
                }
            })
            loginBtnForLoginEle.addEventListener('click', function (event) {
                event.preventDefault()
                var loginFormData = {
                    loginEmail: emailForLoginEle.innerHTML,
                    loginPassword: pwForLoginEle.value,
                }
                function signInWithEmailPassword() {
                    if (loginFormData.loginEmail == '電郵' || loginFormData.loginEmail == '') {
                        loginMessageEle.className = 'box'
                        loginMessageEle.innerHTML = '請輸入電郵'
                        setTimeout(() => {
                            loginMessageEle.className = ''
                            loginMessageEle.innerHTML = ''
                        }, 3000);
                    } else if (loginFormData.loginPassword == '密碼' || loginFormData.loginPassword == '') {
                        loginMessageEle.className = 'box'
                        loginMessageEle.innerHTML = '請輸入密碼'
                        setTimeout(() => {
                            loginMessageEle.className = ''
                            loginMessageEle.innerHTML = ''
                        }, 3000);
                    } else {
                        firebase.auth().signInWithEmailAndPassword(loginFormData.loginEmail, loginFormData.loginPassword)
                            .then((user) => {
                                if (!window.matchMedia("(min-width: 650px)").matches) {
                                    webNameEle.style.display = 'none'
                                    webNameSplitEle.style.display = 'none'
                                }
                                homeScreenEle.style.display = 'block'
                                loginScreenEle.style.display = 'none'
                                pwMgrScreenEle.style.display = 'none'
                                pwSaveScreenEle.style.display = 'none'
                                pwCreateScreenEle.style.display = 'none'
                                welcomeMessageEle.innerHTML = '歡迎回來, ' + loginFormData.loginEmail.split('@')[0]
                                iconEle.forEach((ele) => {
                                    ele.style.display = 'flex'
                                })
                            })
                            .catch((error) => {
                                var errorCode = error.code;
                                var errorMessage = error.message;
                                loginMessageEle.className = 'box'
                                loginMessageEle.innerHTML = errorMessage
                                setTimeout(() => {
                                    loginMessageEle.className = ''
                                    loginMessageEle.innerHTML = ''
                                }, 3000);
                            });
                    }
                }
                signInWithEmailPassword()
            })

            // Home Section
            var countdownEle = document.querySelector('#countdown')
            homeBtnEle.forEach((ele) => {
                ele.addEventListener('click', () => {
                    homeScreenEle.style.display = 'block'
                    loginScreenEle.style.display = 'none'
                    pwMgrScreenEle.style.display = 'none'
                    pwSaveScreenEle.style.display = 'none'
                    pwCreateScreenEle.style.display = 'none'
                })
            })
            function countdown() {
                var date = Math.floor(Date.now() / 1000)
                var sec = date % 60
                var min = (date - sec) / 60
                var hrs = (min - min % 60) / 60
                var day = (hrs - hrs % 24) / 24
                var startDate = new Date(2018, 4, 12) / 1000
                var secForStartDate = startDate % 60
                var minForStartDate = (startDate - secForStartDate) / 60
                var hrsForStartDate = (minForStartDate - minForStartDate % 60) / 60
                var dayForStartDate = (hrsForStartDate - hrsForStartDate % 24) / 24
                countdownEle.innerHTML = `與BB豬已一起渡過${day - dayForStartDate}日`
            }
            countdown()
            setInterval(() => {
                countdown()
            }, 1000);

            // Password Manager
            var webListEle = document.querySelector('#webList')
            var pwDetailEle = document.querySelector('#pwDetail')
            var searchBoxEle = document.querySelector('#searchBox')
            pwMgrBtnEle.forEach((ele) => {
                ele.addEventListener('click', function () {
                    homeScreenEle.style.display = 'none'
                    loginScreenEle.style.display = 'none'
                    pwMgrScreenEle.style.display = 'block'
                    pwSaveScreenEle.style.display = 'none'
                    pwCreateScreenEle.style.display = 'none'
                    searchBoxEle.innerHTML = '搜尋...'
                    searchBoxEle.style.color = '#aaaaaa'
                    while (pwDetailEle.firstChild) {
                        pwDetailEle.removeChild(pwDetailEle.firstChild)
                    }
                    db.collection('Password').where('User', '==', firebase.auth().currentUser.email.split('@')[0]).get().then(function (snapshot) {
                        var arrayOfWeb = []
                        snapshot.forEach((doc) => {
                            while (webListEle.firstChild) {
                                webListEle.removeChild(webListEle.firstChild)
                            }
                            arrayOfWeb.push(doc.data().Web)
                            var uniqueArrayOfWeb = new Set(arrayOfWeb.sort())
                            uniqueArrayOfWeb.forEach((web) => {
                                var webDiv = document.createElement('div')
                                webDiv.className = 'link web'
                                webDiv.id = web
                                webDiv.innerHTML = web
                                webListEle.append(webDiv)
                            })
                        })
                        var webEle = document.querySelectorAll('.web')
                        webEle.forEach((div) => {
                            div.addEventListener('click', function () {
                                while (pwDetailEle.firstChild) {
                                    pwDetailEle.removeChild(pwDetailEle.firstChild)
                                }
                                var pwListHeading = document.createElement('div')
                                pwListHeading.className = 'pwContent'
                                pwListHeading.style.flex = '1'
                                pwListHeading.innerHTML = div.innerHTML
                                pwDetailEle.append(pwListHeading)
                                db.collection('Password').where('Web', '==', div.innerHTML.replace('&amp;', '&')).orderBy('Index').get().then(function (snapshot) {
                                    snapshot.forEach((doc) => {
                                        if (firebase.auth().currentUser.email.split('@')[0] == doc.data().User) {
                                            var flexboxContainer = document.createElement('div')
                                            flexboxContainer.className = 'flexbox'
                                            pwDetailEle.append(flexboxContainer)
                                            var div = document.createElement('div')
                                            div.className = 'pwContent'
                                            div.style.flex = '1'
                                            flexboxContainer.append(div)
                                            var pwContent = document.createElement('div')
                                            pwContent.innerHTML = `
                                            <span>登入ID: </span>
                                            <div id='${doc.data().ID}' class='pw textField' style='width: 100%;'>${doc.data().ID}</div>
                                            <span>登入密碼: </span>
                                            <div id='${doc.data().Password}' class='pw textField' style='width: 100%;'>${doc.data().Password}</div>
                                            `
                                            div.append(pwContent)
                                            var flexbox = document.createElement('div')
                                            flexbox.style.display = 'flex'
                                            flexbox.style.flexWrap = 'wrap'
                                            div.append(flexbox)
                                            var copyIDButton = document.createElement('button')
                                            copyIDButton.innerHTML = '複製ID'
                                            copyIDButton.style.flex = 1
                                            var copyPasswordButton = document.createElement('button')
                                            copyPasswordButton.innerHTML = '複製密碼'
                                            copyPasswordButton.style.flex = 1
                                            var brForFlex = document.createElement('div')
                                            brForFlex.style.flexBasis = '100%'
                                            brForFlex.style.height = '0'
                                            var modifyButton = document.createElement('button')
                                            modifyButton.innerHTML = '編輯'
                                            modifyButton.style.flex = 1
                                            var deleteButton = document.createElement('button')
                                            deleteButton.innerHTML = '刪除'
                                            deleteButton.style.flex = 1
                                            copyIDButton.addEventListener('click', function () {
                                                copyDivToClipboard(doc.data().ID)
                                            })
                                            copyPasswordButton.addEventListener('click', function () {
                                                copyDivToClipboard(doc.data().Password.replace('&amp;', '&'))
                                            })
                                            modifyButton.addEventListener('click', () => {
                                                var alertBoxBackground = document.createElement('div')
                                                alertBoxBackground.className = 'alertBoxBackground'
                                                var div = document.createElement('div')
                                                div.className = 'flexbox alertBox'
                                                var loginIDForModifyLabel = document.createElement('span')
                                                loginIDForModifyLabel.innerHTML = '登入ID'
                                                var loginIDForModifyInput = document.createElement('div')
                                                loginIDForModifyInput.className = 'textField'
                                                loginIDForModifyInput.innerHTML = '登入ID'
                                                loginIDForModifyInput.contentEditable = 'true'
                                                loginIDForModifyInput.style.width = '200px'
                                                var loginPwForModifyLabel = document.createElement('span')
                                                loginPwForModifyLabel.innerHTML = '登入密碼'
                                                var loginPwForModifyInput = document.createElement('div')
                                                loginPwForModifyInput.className = 'textField'
                                                loginPwForModifyInput.innerHTML = '登入密碼'
                                                loginPwForModifyInput.contentEditable = 'true'
                                                loginPwForModifyInput.style.width = '200px'
                                                var submitBtnForModify = document.createElement('button')
                                                submitBtnForModify.type = 'submit'
                                                submitBtnForModify.innerHTML = '儲存'
                                                submitBtnForModify.style.width = '50%'
                                                var cancelBtnForModify = document.createElement('button')
                                                cancelBtnForModify.innerHTML = '取消'
                                                cancelBtnForModify.style.width = '50%'
                                                var modifyStatus = document.createElement('div')
                                                modifyStatus.style.display = 'none'
                                                loginIDForModifyInput.addEventListener('focus', () => {
                                                    if (loginIDForModifyInput.innerHTML == '登入ID') {
                                                        loginIDForModifyInput.innerHTML = ''
                                                        loginIDForModifyInput.style.color = '#ffffff'
                                                        loginIDForModifyInput.style.outlineStyle = 'none'
                                                    }
                                                })
                                                loginIDForModifyInput.addEventListener('focusout', () => {
                                                    if (loginIDForModifyInput.innerHTML == '') {
                                                        loginIDForModifyInput.innerHTML = '登入ID'
                                                        loginIDForModifyInput.style.color = '#aaaaaa'
                                                    }
                                                })
                                                loginIDForModifyInput.addEventListener('keypress', (e) => {
                                                    if (e.which == 13) {
                                                        e.preventDefault()
                                                    }
                                                })
                                                loginPwForModifyInput.addEventListener('focus', () => {
                                                    if (loginPwForModifyInput.innerHTML == '登入密碼') {
                                                        loginPwForModifyInput.innerHTML = ''
                                                        loginPwForModifyInput.style.color = '#ffffff'
                                                        loginPwForModifyInput.style.outlineStyle = 'none'
                                                    }
                                                })
                                                loginPwForModifyInput.addEventListener('focusout', () => {
                                                    if (loginPwForModifyInput.innerHTML == '') {
                                                        loginPwForModifyInput.innerHTML = '登入密碼'
                                                        loginPwForModifyInput.style.color = '#aaaaaa'
                                                    }
                                                })
                                                loginPwForModifyInput.addEventListener('keypress', (e) => {
                                                    if (e.which == 13) {
                                                        e.preventDefault()
                                                    }
                                                })
                                                submitBtnForModify.addEventListener('click', () => {
                                                    event.preventDefault()
                                                    var date = new Date()
                                                    var modifyData = {
                                                        LoginID: loginIDForModifyInput.innerHTML,
                                                        LoginPw: loginPwForModifyInput.innerHTML,
                                                        OriginalPw: doc.data().Password,
                                                    }
                                                    if ((!modifyData.LoginID || modifyData.LoginID == '登入ID') && (!modifyData.LoginPw || modifyData.LoginPw == '登入密碼')) {
                                                        modifyStatus.style.display = 'block'
                                                        modifyStatus.innerHTML = '請輸入ID或密碼!!!'
                                                        setTimeout(() => {
                                                            modifyStatus.style.display = 'none'
                                                            modifyStatus.innerHTML = ''
                                                        }, 3000);
                                                    } else if (!modifyData.LoginPw || modifyData.LoginPw == '登入密碼') {
                                                        db.collection('Password').doc(doc.id).update({
                                                            ID: modifyData.LoginID
                                                        })
                                                        modifyStatus.style.display = 'block'
                                                        modifyStatus.innerHTML = 'ID已更新!!!'
                                                        setTimeout(() => {
                                                            modifyStatus.style.display = 'none'
                                                            modifyStatus.innerHTML = ''
                                                            loginIDForModifyInput.innerHTML = '登入ID'
                                                            loginIDForModifyInput.style.color = '#aaaaaa'
                                                            loginPwForModifyInput.innerHTML = '登入密碼'
                                                            loginPwForModifyInput.style.color = '#aaaaaa'
                                                            alertBoxBackground.parentNode.removeChild(alertBoxBackground)
                                                            var pwListRefresh = document.querySelector(`#${doc.data().Web}`)
                                                            try {
                                                                pwMgrBtnEle.forEach((ele) => { ele.click() })
                                                                pwListRefresh.click()
                                                            } catch (err) { }
                                                        }, 3000);
                                                    } else if (!modifyData.LoginID || modifyData.LoginID == '登入ID') {
                                                        console.log(doc.data().LastModify1 !== undefined)
                                                        console.log(doc.data().LastModify2 !== undefined)
                                                        if (doc.data().LastModify2 !== undefined) {
                                                            db.collection('Password').doc(doc.id).update({
                                                                Password: modifyData.LoginPw,
                                                                LastModify3: doc.data().LastModify2,
                                                                LastModify2: doc.data().LastModify1,
                                                                LastModify1: modifyData.OriginalPw + ' - ' + date,
                                                            })
                                                        } else if (doc.data().LastModify1 !== undefined) {
                                                            db.collection('Password').doc(doc.id).update({
                                                                Password: modifyData.LoginPw,
                                                                LastModify2: doc.data().LastModify1,
                                                                LastModify1: modifyData.OriginalPw + ' - ' + date,
                                                            })
                                                        } else {
                                                            db.collection('Password').doc(doc.id).update({
                                                                Password: modifyData.LoginPw,
                                                                LastModify1: modifyData.OriginalPw + ' - ' + date,
                                                            })
                                                        }
                                                        modifyStatus.style.display = 'block'
                                                        modifyStatus.innerHTML = '密碼已更新!!!'
                                                        setTimeout(() => {
                                                            modifyStatus.style.display = 'none'
                                                            modifyStatus.innerHTML = ''
                                                            loginIDForModifyInput.innerHTML = '登入ID'
                                                            loginIDForModifyInput.style.color = '#aaaaaa'
                                                            loginPwForModifyInput.innerHTML = '登入密碼'
                                                            loginPwForModifyInput.style.color = '#aaaaaa'
                                                            alertBoxBackground.parentNode.removeChild(alertBoxBackground)
                                                            var pwListRefresh = document.querySelector(`#${doc.data().Web}`)
                                                            pwMgrBtnEle.forEach((ele) => { ele.click() })
                                                            try {
                                                                pwListRefresh.click()
                                                            } catch (err) { }
                                                        }, 3000);
                                                    } else {
                                                        if (doc.data().LastModify2 == true) {
                                                            db.collection('Password').doc(doc.id).update({
                                                                ID: modifyData.LoginID,
                                                                Password: modifyData.LoginPw,
                                                                LastModify3: doc.data().LastModify2,
                                                                LastModify2: doc.data().LastModify1,
                                                                LastModify1: modifyData.OriginalPw + ' - ' + date,
                                                            })
                                                        } else if (doc.data().LastModify1 == true) {
                                                            db.collection('Password').doc(doc.id).update({
                                                                ID: modifyData.LoginID,
                                                                Password: modifyData.LoginPw,
                                                                LastModify2: doc.data().LastModify1,
                                                                LastModify1: modifyData.OriginalPw + ' - ' + date,
                                                            })
                                                        } else {
                                                            db.collection('Password').doc(doc.id).update({
                                                                ID: modifyData.LoginID,
                                                                Password: modifyData.LoginPw,
                                                                LastModify1: modifyData.OriginalPw + ' - ' + date,
                                                            })
                                                        }
                                                        modifyStatus.style.display = 'block'
                                                        modifyStatus.innerHTML = 'ID及密碼已更新!!!'
                                                        setTimeout(() => {
                                                            modifyStatus.style.display = 'none'
                                                            modifyStatus.innerHTML = ''
                                                            loginIDForModifyInput.innerHTML = '登入ID'
                                                            loginIDForModifyInput.style.color = '#aaaaaa'
                                                            loginPwForModifyInput.innerHTML = '登入密碼'
                                                            loginPwForModifyInput.style.color = '#aaaaaa'
                                                            alertBoxBackground.parentNode.removeChild(alertBoxBackground)
                                                            var pwListRefresh = document.querySelector(`#${doc.data().Web}`)
                                                            pwMgrBtnEle.forEach((ele) => { ele.click() })
                                                            try {
                                                                pwListRefresh.click()
                                                            } catch (err) { }
                                                        }, 3000);
                                                    }
                                                })
                                                cancelBtnForModify.addEventListener('click', () => {
                                                    loginIDForModifyInput.innerHTML = '登入ID'
                                                    loginIDForModifyInput.style.color = '#aaaaaa'
                                                    loginPwForModifyInput.innerHTML = '登入密碼'
                                                    loginPwForModifyInput.style.color = '#aaaaaa'
                                                    alertBoxBackground.parentNode.removeChild(alertBoxBackground)
                                                })
                                                pwMgrScreenEle.append(alertBoxBackground)
                                                alertBoxBackground.append(div)
                                                div.append(loginIDForModifyLabel)
                                                div.append(loginIDForModifyInput)
                                                div.append(loginPwForModifyLabel)
                                                div.append(loginPwForModifyInput)
                                                div.append(submitBtnForModify)
                                                div.append(cancelBtnForModify)
                                                div.append(modifyStatus)
                                            })
                                            deleteButton.addEventListener('click', function () {
                                                var alertBoxBackground = document.createElement('div')
                                                alertBoxBackground.className = 'alertBoxBackground'
                                                var div = document.createElement('div')
                                                div.className = 'flexbox alertBox'
                                                var alertText = document.createElement('div')
                                                alertText.innerHTML = '注意!!! <br>是否確認刪除密碼?<br>動作將無法復原!!!'
                                                alertText.style.whiteSpace = 'nowrap'
                                                alertText.style.padding = '0 5px 5px'
                                                alertText.style.textAlign = 'center'
                                                var deleteYesButton = document.createElement('button')
                                                deleteYesButton.innerHTML = '是'
                                                deleteYesButton.style.flex = '1'
                                                var deleteNoButton = document.createElement('button')
                                                deleteNoButton.innerHTML = '否'
                                                deleteNoButton.style.flex = '1'
                                                deleteYesButton.addEventListener('click', () => {
                                                    var pwListRefresh = document.querySelector(`#${doc.data().Web}`)
                                                    db.collection('Password').doc(doc.id).delete()
                                                    alertBoxBackground.parentNode.removeChild(alertBoxBackground)
                                                    setTimeout(() => {
                                                        pwMgrBtnEle.forEach((ele) => { ele.click() })
                                                        try {
                                                            pwListRefresh.click()
                                                        } catch (err) { }
                                                    }, 100);
                                                })
                                                deleteNoButton.addEventListener('click', () => {
                                                    alertBoxBackground.parentNode.removeChild(alertBoxBackground)
                                                })
                                                pwMgrScreenEle.append(alertBoxBackground)
                                                alertBoxBackground.append(div)
                                                div.append(alertText)
                                                div.append(deleteYesButton)
                                                div.append(deleteNoButton)
                                            })
                                            flexbox.append(copyIDButton)
                                            flexbox.append(copyPasswordButton)
                                            flexbox.append(brForFlex)
                                            flexbox.append(modifyButton)
                                            flexbox.append(deleteButton)
                                            var moveBtnContainer = document.createElement('div')
                                            moveBtnContainer.className = 'flexbox'
                                            moveBtnContainer.style.flexDirection = 'column'
                                            var moveUpBtn = document.createElement('div')
                                            moveUpBtn.className = 'pwContent link'
                                            moveUpBtn.style.width = 'calc(30px + 1rem)'
                                            moveUpBtn.style.textAlign = 'center'
                                            moveUpBtn.innerHTML = '△'
                                            var positionIndex = document.createElement('div')
                                            positionIndex.className = 'pwContent'
                                            positionIndex.id = `${doc.data().Web}${doc.data().Index}`
                                            positionIndex.style.width = 'calc(30px + 1rem)'
                                            positionIndex.style.textAlign = 'center'
                                            positionIndex.innerHTML = doc.data().Index
                                            var moveDownBtn = document.createElement('div')
                                            moveDownBtn.className = 'pwContent link'
                                            moveDownBtn.style.width = 'calc(30px + 1rem)'
                                            moveDownBtn.style.textAlign = 'center'
                                            moveDownBtn.innerHTML = '▽'
                                            moveUpBtn.addEventListener('click', () => {
                                                if (doc.data().Index !== 1) {
                                                    db.collection('Password').where('Web', '==', doc.data().Web).where('Index', '==', Number(doc.data().Index) - 1).limit(1).get().then((snapshot) => {
                                                        snapshot.forEach((doc) => {
                                                            db.collection('Password').doc(doc.id).update({
                                                                Index: Number(doc.data().Index) + 1
                                                            })
                                                        })
                                                    })
                                                    db.collection('Password').doc(doc.id).update({
                                                        Index: Number(doc.data().Index) - 1
                                                    })
                                                }
                                                var pwListRefresh = document.querySelector(`#${doc.data().Web}`)
                                                setTimeout(() => {
                                                    pwListRefresh.click()
                                                }, 500);
                                            })
                                            moveDownBtn.addEventListener('click', () => {
                                                db.collection('Password').where('Web', '==', doc.data().Web).where('Index', '==', Number(doc.data().Index) + 1).limit(1).get().then((snapshot) => {
                                                    snapshot.forEach((doc) => {
                                                        db.collection('Password').doc(doc.id).update({
                                                            Index: Number(doc.data().Index) - 1
                                                        })
                                                    })
                                                })
                                                db.collection('Password').doc(doc.id).update({
                                                    Index: Number(doc.data().Index) + 1
                                                })
                                                var pwListRefresh = document.querySelector(`#${doc.data().Web}`)
                                                setTimeout(() => {
                                                    pwListRefresh.click()
                                                }, 500);
                                            })
                                            flexboxContainer.append(moveBtnContainer)
                                            moveBtnContainer.append(moveUpBtn)
                                            moveBtnContainer.append(positionIndex)
                                            moveBtnContainer.append(moveDownBtn)
                                        }
                                    })
                                })
                            })
                        })
                    })
                    searchBoxEle.addEventListener('focus', () => {
                        if (searchBoxEle.innerHTML == '搜尋...') {
                            searchBoxEle.innerHTML = ''
                            searchBoxEle.style.color = '#ffffff'
                            searchBoxEle.style.outlineStyle = 'none'
                        }
                    })
                    searchBoxEle.addEventListener('focusout', () => {
                        if (searchBoxEle.innerHTML == '') {
                            searchBoxEle.innerHTML = '搜尋...'
                            searchBoxEle.style.color = '#aaaaaa'
                        }
                    })
                    searchBoxEle.addEventListener('keypress', (e) => {
                        if (e.which == 13) {
                            e.preventDefault()
                        }
                    })
                    var events = ['input', 'change', 'cut', 'copy', 'paste']
                    events.forEach((event) => {
                        searchBoxEle.addEventListener(event, () => {
                            var webs = document.querySelectorAll('.web')
                            webs.forEach((web) => {
                                if (!web.innerHTML.toLowerCase().includes(searchBoxEle.innerHTML.toLowerCase())) {
                                    web.style.display = 'none'
                                } else {
                                    web.style.display = 'block'
                                }
                            })
                        }
                        )
                    })
                })
            })

            // Password Saver
            var webSelectionForPwSaveEle = document.querySelector('#webSelectionForPwSave')
            var webIfOtherForPwSaveEle = document.querySelector('#webIfOtherForPwSave')
            var loginIDForPwSaveEle = document.querySelector('#loginIDForPwSave')
            var loginPwForPwSaveEle = document.querySelector('#loginPwForPwSave')
            var saveBtnForPwSaveEle = document.querySelector('#saveBtnForPwSave')
            var savingStatusForPwSaveEle = document.querySelector('#savingStatusForPwSave')
            function refreshWebSelectionForPwSave() {
                db.collection('Password').where('User', '==', firebase.auth().currentUser.email.split('@')[0]).get().then(function (snapshot) {
                    var arrayOfWeb = []
                    snapshot.forEach((doc) => {
                        while (webSelectionForPwSaveEle.firstChild) {
                            webSelectionForPwSaveEle.removeChild(webSelectionForPwSaveEle.firstChild)
                        }
                        arrayOfWeb.push(doc.data().Web)
                        var uniqueArrayOfWeb = new Set(arrayOfWeb.sort())
                        uniqueArrayOfWeb.forEach((web) => {
                            var webOption = document.createElement('option')
                            webOption.innerHTML = web
                            webOption.value = web
                            webSelectionForPwSaveEle.append(webOption)
                        })
                    })
                    var webOtherOption = document.createElement('option')
                    webOtherOption.innerHTML = '其他'
                    webOtherOption.value = 'Other'
                    webSelectionForPwSaveEle.append(webOtherOption)
                })
            }
            pwSaveBtnEle.forEach((ele) => {
                ele.addEventListener('click', function () {
                    homeScreenEle.style.display = 'none'
                    loginScreenEle.style.display = 'none'
                    pwMgrScreenEle.style.display = 'none'
                    pwSaveScreenEle.style.display = 'block'
                    pwCreateScreenEle.style.display = 'none'
                    webIfOtherForPwSaveEle.innerHTML = '其他網頁...'
                    webIfOtherForPwSaveEle.style.color = '#aaaaaa'
                    loginIDForPwSaveEle.innerHTML = '登入ID'
                    loginIDForPwSaveEle.style.color = '#aaaaaa'
                    loginPwForPwSaveEle.innerHTML = '登入密碼'
                    loginPwForPwSaveEle.style.color = '#aaaaaa'
                    refreshWebSelectionForPwSave()
                    webIfOtherForPwSaveEle.addEventListener('focus', () => {
                        if (webIfOtherForPwSaveEle.innerHTML == '其他網頁...') {
                            webIfOtherForPwSaveEle.innerHTML = ''
                            webIfOtherForPwSaveEle.style.color = '#ffffff'
                            webIfOtherForPwSaveEle.style.outlineStyle = 'none'
                        }
                    })
                    webIfOtherForPwSaveEle.addEventListener('focusout', () => {
                        if (webIfOtherForPwSaveEle.innerHTML == '') {
                            webIfOtherForPwSaveEle.innerHTML = '其他網頁...'
                            webIfOtherForPwSaveEle.style.color = '#aaaaaa'
                        }
                    })
                    webIfOtherForPwSaveEle.addEventListener('keypress', (e) => {
                        if (e.which == 13) {
                            e.preventDefault()
                        }
                    })
                    loginIDForPwSaveEle.addEventListener('focus', () => {
                        if (loginIDForPwSaveEle.innerHTML == '登入ID') {
                            loginIDForPwSaveEle.innerHTML = ''
                            loginIDForPwSaveEle.style.color = '#ffffff'
                            loginIDForPwSaveEle.style.outlineStyle = 'none'
                        }
                    })
                    loginIDForPwSaveEle.addEventListener('focusout', () => {
                        if (loginIDForPwSaveEle.innerHTML == '') {
                            loginIDForPwSaveEle.innerHTML = '登入ID'
                            loginIDForPwSaveEle.style.color = '#aaaaaa'
                        }
                    })
                    loginIDForPwSaveEle.addEventListener('keypress', (e) => {
                        if (e.which == 13) {
                            e.preventDefault()
                        }
                    })
                    loginPwForPwSaveEle.addEventListener('focus', () => {
                        if (loginPwForPwSaveEle.innerHTML == '登入密碼') {
                            loginPwForPwSaveEle.innerHTML = ''
                            loginPwForPwSaveEle.style.color = '#ffffff'
                            loginPwForPwSaveEle.style.outlineStyle = 'none'
                        }
                    })
                    loginPwForPwSaveEle.addEventListener('focusout', () => {
                        if (loginPwForPwSaveEle.innerHTML == '') {
                            loginPwForPwSaveEle.innerHTML = '登入密碼'
                            loginPwForPwSaveEle.style.color = '#aaaaaa'
                        }
                    })
                    loginPwForPwSaveEle.addEventListener('keypress', (e) => {
                        if (e.which == 13) {
                            e.preventDefault()
                        }
                    })
                })
            })
            saveBtnForPwSaveEle.addEventListener('click', () => {
                event.preventDefault()
                var savePwDataForPwSave = {
                    Web: webSelectionForPwSaveEle[webSelectionForPwSaveEle.selectedIndex].value,
                    WebIfOther: webIfOtherForPwSaveEle.innerHTML,
                    LoginID: loginIDForPwSaveEle.innerHTML,
                    LoginPw: loginPwForPwSaveEle.innerHTML,
                }
                if (savePwDataForPwSave.Web == 'Other' && (savePwDataForPwSave.WebIfOther == '其他網頁...' || savePwDataForPwSave.WebIfOther == '')) {
                    savingStatusForPwSaveEle.className = 'box'
                    savingStatusForPwSaveEle.innerHTML = '欠缺網頁名稱!'
                    setTimeout(() => {
                        savingStatusForPwSaveEle.className = ''
                        savingStatusForPwSaveEle.innerHTML = ''
                    }, 3000);
                } else if (savePwDataForPwSave.Web == 'Other' && (savePwDataForPwSave.WebIfOther.includes('@') || savePwDataForPwSave.WebIfOther.startsWith('0') || savePwDataForPwSave.WebIfOther.startsWith('1') || savePwDataForPwSave.WebIfOther.startsWith('2') || savePwDataForPwSave.WebIfOther.startsWith('3') || savePwDataForPwSave.WebIfOther.startsWith('4') || savePwDataForPwSave.WebIfOther.startsWith('5') || savePwDataForPwSave.WebIfOther.startsWith('6') || savePwDataForPwSave.WebIfOther.startsWith('7') || savePwDataForPwSave.WebIfOther.startsWith('8') || savePwDataForPwSave.WebIfOther.startsWith('9'))) {
                    savingStatusForPwSaveEle.className = 'box'
                    savingStatusForPwSaveEle.innerHTML = '欠缺網頁無效!'
                    setTimeout(() => {
                        savingStatusForPwSaveEle.className = ''
                        savingStatusForPwSaveEle.innerHTML = ''
                    }, 3000);
                } else if (savePwDataForPwSave.LoginID == '登入ID' || savePwDataForPwSave.LoginID == '') {
                    savingStatusForPwSaveEle.className = 'box'
                    savingStatusForPwSaveEle.innerHTML = '欠缺登入ID!'
                    setTimeout(() => {
                        savingStatusForPwSaveEle.className = ''
                        savingStatusForPwSaveEle.innerHTML = ''
                    }, 3000);
                } else if (savePwDataForPwSave.LoginPw == '') {
                    savingStatusForPwSaveEle.className = 'box'
                    savingStatusForPwSaveEle.innerHTML = '欠缺登入密碼!'
                    setTimeout(() => {
                        savingStatusForPwSaveEle.className = ''
                        savingStatusForPwSaveEle.innerHTML = ''
                    }, 3000);
                } else {
                    if (savePwDataForPwSave.Web !== 'Other') {
                        var numOfPwForPwSave
                        db.collection('Password').where('Web', '==', savePwDataForPwSave.Web).orderBy('Index', 'desc').limit(1).get().then((snapshot) => {
                            snapshot.forEach((doc) => {
                                numOfPwForPwSave = doc.data().Index + 1
                            })
                            db.collection('Password').add({
                                Web: savePwDataForPwSave.Web,
                                ID: savePwDataForPwSave.LoginID,
                                Password: savePwDataForPwSave.LoginPw,
                                User: firebase.auth().currentUser.email.split('@')[0],
                                Index: numOfPwForPwSave,
                            })
                            savingStatusForPwSaveEle.innerHTML = '密碼已儲存!'
                            savingStatusForPwSaveEle.className = 'box'
                            setTimeout(() => {
                                savingStatusForPwSaveEle.innerHTML = ''
                                savingStatusForPwSaveEle.className = ''
                                webIfOtherForPwSaveEle.innerHTML = '其他網頁...'
                                webIfOtherForPwSaveEle.style.color = '#aaaaaa'
                                loginIDForPwSaveEle.innerHTML = '登入ID'
                                loginIDForPwSaveEle.style.color = '#aaaaaa'
                                loginPwForPwSaveEle.innerHTML = '登入密碼'
                                loginPwForPwSaveEle.style.color = '#aaaaaa'
                                refreshWebSelectionForPwSave()
                            }, 3000);
                        })
                    } else {
                        db.collection('Password').add({
                            Web: savePwDataForPwSave.WebIfOther,
                            ID: savePwDataForPwSave.LoginID,
                            Password: savePwDataForPwSave.LoginPw,
                            User: firebase.auth().currentUser.email.split('@')[0],
                            Index: 1,
                        })
                        savingStatusForPwSaveEle.innerHTML = '密碼已儲存!'
                        savingStatusForPwSaveEle.className = 'box'
                        setTimeout(() => {
                            savingStatusForPwSaveEle.innerHTML = ''
                            savingStatusForPwSaveEle.className = ''
                            webIfOtherForPwSaveEle.innerHTML = '其他網頁...'
                            webIfOtherForPwSaveEle.style.color = '#aaaaaa'
                            loginIDForPwSaveEle.innerHTML = '登入ID'
                            loginIDForPwSaveEle.style.color = '#aaaaaa'
                            loginPwForPwSaveEle.innerHTML = '登入密碼'
                            loginPwForPwSaveEle.style.color = '#aaaaaa'
                            refreshWebSelectionForPwSave()
                        }, 3000);
                    }
                }
            })

            // Password Creator
            var pwGenFormEle = document.querySelector('#pwGenForm')
            var showPwForGenEle = document.querySelector('#showPwForGen')
            var copyGenPwEle = document.querySelector('#copyGenPw')
            var webSelectionForGenPwEle = document.querySelector('#webSelectionForGenPw')
            var webIfOtherForGenPwEle = document.querySelector('#webIfOtherForGenPw')
            var loginIDForGenPwEle = document.querySelector('#loginIDForGenPw')
            var saveBtnForGenPwEle = document.querySelector('#saveBtnForGenPw')
            var savingStatusEle = document.querySelector('#savingStatusForGenPw')
            function refreshWebSelectionForPwGen() {
                db.collection('Password').where('User', '==', firebase.auth().currentUser.email.split('@')[0]).get().then(function (snapshot) {
                    var arrayOfWeb = []
                    snapshot.forEach((doc) => {
                        while (webSelectionForGenPwEle.firstChild) {
                            webSelectionForGenPwEle.removeChild(webSelectionForGenPwEle.firstChild)
                        }
                        arrayOfWeb.push(doc.data().Web)
                        var uniqueArrayOfWeb = new Set(arrayOfWeb.sort())
                        uniqueArrayOfWeb.forEach((web) => {
                            var webOption = document.createElement('option')
                            webOption.innerHTML = web
                            webOption.value = web
                            webSelectionForGenPwEle.append(webOption)
                        })
                    })
                    var webOtherOption = document.createElement('option')
                    webOtherOption.innerHTML = '其他'
                    webOtherOption.value = 'Other'
                    webSelectionForGenPwEle.append(webOtherOption)
                })
            }
            pwCreateBtnEle.forEach((ele) => {
                ele.addEventListener('click', function () {
                    homeScreenEle.style.display = 'none'
                    loginScreenEle.style.display = 'none'
                    pwMgrScreenEle.style.display = 'none'
                    pwSaveScreenEle.style.display = 'none'
                    pwCreateScreenEle.style.display = 'block'
                    webIfOtherForGenPwEle.innerHTML = '其他網頁...'
                    webIfOtherForGenPwEle.style.color = '#aaaaaa'
                    loginIDForGenPwEle.innerHTML = '登入ID'
                    loginIDForGenPwEle.style.color = '#aaaaaa'
                    refreshWebSelectionForPwGen()
                    pwGenFormEle.reset()
                    pwGenFormEle.addEventListener('submit', () => {
                        var numOfDigits = pwGenFormEle.numOfDigits.value
                        if (numOfDigits == '') {
                            event.preventDefault()
                            pwGenFormEle.reset()
                        } else {
                            event.preventDefault()
                            var char = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789~!@#$%^&*'
                            var charNoSymbols = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'
                            var lowerCaseString = 'abcdefghijklmnopqrstuvwxyz'
                            var upperCaseString = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
                            var numString = '0123456789'
                            var symbolString = '~!@#$%^&*'
                            var lowerCaseArray = lowerCaseString.split('')
                            var upperCaseArray = upperCaseString.split('')
                            var numArray = numString.split('')
                            var symbolArray = symbolString.split('')
                            var pwGen = ''
                            var genContainsSymbolsValue = document.querySelector('#genContainsSymbols').checked
                            function contains(target, pattern) {
                                var value = 0;
                                pattern.forEach(function (word) {
                                    value = value + target.includes(word);
                                });
                                return (!Boolean(value))
                            }
                            if (genContainsSymbolsValue) {
                                while (contains(pwGen, lowerCaseArray) || contains(pwGen, upperCaseArray) || contains(pwGen, numArray)) {
                                    pwGen = ''
                                    while (pwGen.length < Number(numOfDigits)) {
                                        var pwGenIndex = Math.floor(Math.random() * char.length)
                                        pwGen += charNoSymbols.charAt(pwGenIndex)
                                    }
                                }
                            } else {
                                while (contains(pwGen, lowerCaseArray) || contains(pwGen, upperCaseArray) || contains(pwGen, numArray) || contains(pwGen, symbolArray)) {
                                    pwGen = ''
                                    while (pwGen.length < Number(numOfDigits)) {
                                        var pwGenIndex = Math.floor(Math.random() * char.length)
                                        pwGen += char.charAt(pwGenIndex)
                                    }
                                }
                            }
                            showPwForGenEle.style.color = '#ffffff'
                            showPwForGenEle.innerHTML = pwGen
                            copyGenPwEle.addEventListener('click', copyDivToClipboard('showPwForGen'))
                        }
                    })
                    webIfOtherForGenPwEle.addEventListener('focus', () => {
                        if (webIfOtherForGenPwEle.innerHTML == '其他網頁...') {
                            webIfOtherForGenPwEle.innerHTML = ''
                            webIfOtherForGenPwEle.style.color = '#ffffff'
                            webIfOtherForGenPwEle.style.outlineStyle = 'none'
                        }
                    })
                    webIfOtherForGenPwEle.addEventListener('focusout', () => {
                        if (webIfOtherForGenPwEle.innerHTML == '') {
                            webIfOtherForGenPwEle.innerHTML = '其他網頁...'
                            webIfOtherForGenPwEle.style.color = '#aaaaaa'
                        }
                    })
                    webIfOtherForGenPwEle.addEventListener('keypress', (e) => {
                        if (e.which == 13) {
                            e.preventDefault()
                        }
                    })
                    loginIDForGenPwEle.addEventListener('focus', () => {
                        if (loginIDForGenPwEle.innerHTML == '登入ID') {
                            loginIDForGenPwEle.innerHTML = ''
                            loginIDForGenPwEle.style.color = '#ffffff'
                            loginIDForGenPwEle.style.outlineStyle = 'none'
                        }
                    })
                    loginIDForGenPwEle.addEventListener('focusout', () => {
                        if (loginIDForGenPwEle.innerHTML == '') {
                            loginIDForGenPwEle.innerHTML = '登入ID'
                            loginIDForGenPwEle.style.color = '#aaaaaa'
                        }
                    })
                    loginIDForGenPwEle.addEventListener('keypress', (e) => {
                        if (e.which == 13) {
                            e.preventDefault()
                        }
                    })
                })
            })
            saveBtnForGenPwEle.addEventListener('click', () => {
                event.preventDefault()
                var savePwDataForGenPw = {
                    Web: webSelectionForGenPwEle[webSelectionForGenPwEle.selectedIndex].value,
                    WebIfOther: webIfOtherForGenPwEle.innerHTML,
                    LoginID: loginIDForGenPwEle.innerHTML,
                    LoginPw: showPwForGenEle.innerHTML,
                }
                if (savePwDataForGenPw.LoginPw == '') {
                    savingStatusEle.className = 'box'
                    savingStatusEle.innerHTML = '請先創建密碼!'
                    setTimeout(() => {
                        savingStatusEle.className = ''
                        savingStatusEle.innerHTML = ''
                    }, 3000);
                } else if (savePwDataForGenPw.Web == 'Other' && (savePwDataForGenPw.WebIfOther == '其他網頁...' || savePwDataForGenPw.WebIfOther == '')) {
                    savingStatusEle.className = 'box'
                    savingStatusEle.innerHTML = '欠缺網頁名稱!'
                    setTimeout(() => {
                        savingStatusEle.className = ''
                        savingStatusEle.innerHTML = ''
                    }, 3000);
                } else if (savePwDataForGenPw.Web == 'Other' && (savePwDataForGenPw.WebIfOther.includes('@') || savePwDataForGenPw.WebIfOther.startsWith('0') || savePwDataForGenPw.WebIfOther.startsWith('1') || savePwDataForGenPw.WebIfOther.startsWith('2') || savePwDataForGenPw.WebIfOther.startsWith('3') || savePwDataForGenPw.WebIfOther.startsWith('4') || savePwDataForGenPw.WebIfOther.startsWith('5') || savePwDataForGenPw.WebIfOther.startsWith('6') || savePwDataForGenPw.WebIfOther.startsWith('7') || savePwDataForGenPw.WebIfOther.startsWith('8') || savePwDataForGenPw.WebIfOther.startsWith('9'))) {
                    savingStatusEle.className = 'box'
                    savingStatusEle.innerHTML = '欠缺網頁無效!'
                    setTimeout(() => {
                        savingStatusEle.className = ''
                        savingStatusEle.innerHTML = ''
                    }, 3000);
                } else if (savePwDataForGenPw.LoginID == '登入ID' || savePwDataForGenPw.LoginID == '') {
                    savingStatusEle.className = 'box'
                    savingStatusEle.innerHTML = '欠缺登入ID!'
                    setTimeout(() => {
                        savingStatusEle.className = ''
                        savingStatusEle.innerHTML = ''
                    }, 3000);
                } else {
                    if (savePwDataForGenPw.Web !== 'Other') {
                        var numOfPwForGenPw
                        db.collection('Password').where('Web', '==', savePwDataForGenPw.Web).orderBy('Index', 'desc').limit(1).get().then((snapshot) => {
                            snapshot.forEach((doc) => {
                                numOfPwForGenPw = doc.data().Index + 1
                            })
                            db.collection('Password').add({
                                Web: savePwDataForGenPw.Web,
                                ID: savePwDataForGenPw.LoginID,
                                Password: savePwDataForGenPw.LoginPw,
                                User: firebase.auth().currentUser.email.split('@')[0],
                                Index: numOfPwForGenPw,
                            })
                            savingStatusEle.innerHTML = '密碼已儲存!'
                            savingStatusEle.className = 'box'
                            setTimeout(() => {
                                savingStatusEle.innerHTML = ''
                                savingStatusEle.className = ''
                                webIfOtherForGenPwEle.innerHTML = '其他網頁...'
                                webIfOtherForGenPwEle.style.color = '#aaaaaa'
                                loginIDForGenPwEle.innerHTML = '登入ID'
                                loginIDForGenPwEle.style.color = '#aaaaaa'
                                refreshWebSelectionForPwGen()
                            }, 3000);
                        })
                    } else {
                        db.collection('Password').add({
                            Web: savePwDataForGenPw.WebIfOther,
                            ID: savePwDataForGenPw.LoginID,
                            Password: savePwDataForGenPw.LoginPw,
                            User: firebase.auth().currentUser.email.split('@')[0],
                            Index: 1,
                        })
                        savingStatusEle.innerHTML = '密碼已儲存!'
                        savingStatusEle.className = 'box'
                        setTimeout(() => {
                            savingStatusEle.innerHTML = ''
                            savingStatusEle.className = ''
                            webIfOtherForGenPwEle.innerHTML = '其他網頁...'
                            webIfOtherForGenPwEle.style.color = '#aaaaaa'
                            loginIDForGenPwEle.innerHTML = '登入ID'
                            loginIDForGenPwEle.style.color = '#aaaaaa'
                            refreshWebSelectionForPwGen()
                        }, 3000);
                    }
                }
            })

            // Logout Section
            logoutBtnEle.forEach((ele) => {
                ele.addEventListener('click', function () {
                    firebase.auth().signOut().then(function () {
                        location.reload()
                    }).catch(function (error) {
                    });
                })
            })
        })
    </script>
</body>

</html>